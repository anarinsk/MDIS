---
title: "Comparing Korean Household Incomes"
author: anarinsk 
date: June 11, 2018
output: 
  html_document: 
    toc: true
    toc_float: true
---

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
#
source("./code_header.R")
readRDS("./data/tbl_gdpd.rds") -> tbl 
readRDS("./data/tbl_smr.rds") -> tbl_smr
#
```

# Disclaimer 

이 글은 언제나 '일시적'입니다. 문제가 생기면 항상 수정됩니다. 대신 수정의 역사는 간단히 남길 예정입니다. 

  1. 20180611 오타 수정 

# 최근의 논란 

최근 최저임금 인상의 효과를 두고 몇가지 논란이 있었다. 일단 분명하게 해 둘 내용부터 짚자. 

  1. (사회) 실험이 아니기 때문에 최저 임금 인상의 효과를 인과관계라는 맥락에서 해석하는 것은 불가능하다. 
  2. 여타 적용할 수 있는 계량경제학적 방법이 없는 것은 아니나, 아직 제대로 된 논의를 못 봤다.  
  
이 와중에 [조선비즈](http://biz.chosun.com/site/data/html_dir/2018/06/03/2018060300817.html)에 정부의 발표를 반박하는 기사가 실렸고, 이에 대해서 [블로고스피어](http://sovidence.tistory.com/950) 상의 비판이 있었다. 이 논란에 개입하는 것이 이 글의 목적이 아니다. 아울러 나는 무슨 대단한 학술적인 의도나 목적을 지니고 있지 않다. 업계나 학계의 상식에 어긋나거나 황당한 내용이 있다면 언제든 지도편달 바란다. 달게 받고 수정하겠다. 다만 한가지 아쉬움만 지적하자. 90% 발언이 논란의 중심인 만큼 정부 혹은 국책 연구기관에서 보다 상세한 해설을 해줬으면 싶다. 

## 글의 목적

  1. 데이터에 기반해 서로 무슨 생각을 하는지 명확히 확인하자. 
  2. 불필요한 것으로 싸우지 않는다. 

# 분석의 전제 

이 분석은 통계청에서 발표하는 가계동향조사에 바탕을 두고 있다. 이 자료의 여러가지 한계는 접어두자. 한계가 있지만 그나마 빠르게 확인할 수 있는 자료가 이 녀석이니 쓰는 것이겠지. 이 분석은 다음과 같이 가정하겠다. 

  1. 가계동향조사를 믿겠다. 
  2. 조사의 가중치를 믿겠다. 
  
  
# 가중치를 어떻게 다룰 것인가? 

가중치는 결국 해당 가구가 모집단에서 어느 정도나 비중을 차지하고 있는지를 나타낸다. 2017년 판 "이용자 가이드"에 보면 다음과 같이 되어 있다. 

>#####가계동향조사의 가중치는 설계가중치와 무응답 가중치를 적용하고 사후 가중한 가중치를 가구별로 부여하며, 가중치는 추출률의 역수로서 각 가구가 대표하는 가구 수를 나타낸다.  

가중치에 관해서 교과서에 나오는 건 교과서적으로 잘 반영되었다는 이야기다. 대안적인 가중치를 구하고 싶어도 추가적인 자료가 필요하다. 그러니 일단 믿도록 하자. 이 가중치를 어떻게 반영할 것인가? 세가지 정도의 방법을 생각해보았다. 

  1. 가중치를 무시하고 대신 100 분위 블록 내 소득 계산에 활용 
  2. 가중치에 따라서 샘플을 늘인 뒤, 해당 샘플로 100분위 블록 계산 
  3. 가중치에 따른 대표 확률에 따라서 샘플링을 반복 
  
첫번째 방법은 가중치를 무시하고 연도별 샘플로 100 분위를 구한다. 대신 해당 분위 내에서 평균 소득 혹은 중위 소득을 구할 때 해당 가중치를 활용해서 가중 평균, 가중 중간값을 구한다. 뭐 구질구질하지만 해볼만한 방법이다 싶다. 둘째 방법은 보다 직관적인 방법이다. 통계청에서도 말하듯이 가중치는 샘플에 속한 각 가구가 대표하는 가구의 수다. 그러면 그 숫자대로 뻥튀기를 한 뒤, 이 녀석으로 다시 100 분위를 내는 방법이다. 

1,2의 방법을 구현해서 [Shiny apps](http://209.97.160.244:3838/MDIS_Shiny_3/)으로 만들어 보았다. 좀 힘들었지만 어쨌든 했다. 결론은 아래 세번째 방법과 비슷하다. 

# 충분히 많은 수의 샘플링 

가중치로 생각해볼 수 있는 또 다른 방식이 있다. 가중치를 바탕으로 해당 샘플을 반복해서 추출하는 것이다. 내가 하는게 아니라 머신이 하니까 부담은 없다. 100 분위 소득이니 속편하게 샘플 수는 100 개로 하자. 그리고 이런 100개 단위 추출을 충분히 많이 한 후, 각 분위별로 소득의 평균을 구해서 비교한다. 과학적인 방법이 아닐지 모르지만, 제법 그럴 듯한 방법이 아닌가, 싶다. 코드를 부분만 옮기면 다음과 같다. 

```{r eval=FALSE, include=TRUE}

vars_basic <- c("V100", "V101", "V102", "V103")

pick_x <- function(year, x, df, what_V4 = c(1,2)){
  df %.>% 
    dplyr::filter(., V1 == year, V4 %in% what_V4) %.>% 
    sample_n(., size = x, replace = T, weight = V99)
}
sim_ndraw <- function(n_draw, what_V4, vars_sel = vars_basic, df=tbl){
#  
  list(year = c(rep(2017,n_draw), rep(2018,n_draw)),  round=c(seq(1:n_draw), seq(1:n_draw))) -> itr_sch
  
  itr_sch %.>% 
    pmap_df(., 
      function(year, round) {
        pick_x(year, 100, df, what_V4) %.>% 
        mutate(., rd = unlist(round)[1]) 
      } 
    ) %.>% 
    dplyr::select(., V1, V3, rd, one_of(vars_sel))
#
}
sim_summary <- function(var, funs, df){
  
  var_exp <- enquo(var)
  
  df %.>% 
    arrange(., V1, rd, -!!var_exp) %.>% 
    group_by(., V1, rd) %.>% 
    mutate(., rank_sample = seq(1:100)) %.>% 
    group_by(., V1, rank_sample) %.>% 
    summarise(., val = funs(!!var_exp)) %.>% 
    group_by(., rank_sample) %.>%  
    mutate(., V1 = factor(V1)) %.>% 
    spread(., key = V1, value = val) %.>% 
    rename(., 
      Y17 = `2017`,
      Y18 = `2018`
      )
}

sim_ndraw(10000, c(1,2), c(vars_basic, "V106")) -> ttl1
sim_ndraw(10000, c(1), c(vars_basic, "V106"))   -> ttl2

ttl1 %.>% 
  sim_summary(V101, mean, .) %.>% 
  mutate(., 
    group = "all" 
  )-> ttl1_1

ttl2 %.>% 
  sim_summary(V101, mean, .)  %.>% 
  mutate(., 
    group = "worker" 
  )-> ttl2_1

ttl1_1 %.>% bind_rows(., ttl2_1) -> tbl_smr 

```

1만 번 샘플링한 위의 결과를 그림으로 나타내보자. 

```{r}
tbl_smr %.>% ggplot(.) + 
  aes(x = rank_sample, y = Y18-Y17) + 
  geom_col(color = "black") + 
  facet_grid(.~group, scales = "free_y") + 
  ggtitle("Sampling Income Mean") + 
  xlab("rank(descending order)") + 
  ylab("Quarterly income") +
  theme_economist()
  
tbl_smr %.>% ggplot(.) + 
  aes(x = rank_sample, y = (Y18-Y17)*100/Y17) + 
  geom_col(color = "black") + 
  facet_wrap(~group, ncol=2) + 
  ggtitle("Sampling Income Change") + 
  xlab("rank(descending order)") + 
  ylab("Change(%)") +
  theme_economist() 
```


## 소득 / 경상 소득

여기서 전체(All) 가구란 노동소득(worker) 가구, 노동외소득(non-worker) 가구를 모두 포함한다는 뜻이다. 이렇게 보면 상위 54 븐위까지 그리고 하위에 속한 98, 99, 100 분위에서 소득 증가가 관찰된다. 노동소득 가구만 보면 전체 분위에서 증가를 관찰할 수 있다. 

## 퍼센트 변화 

소득 규모에 따른 효과를 보기 위해서 각 구간별로 퍼센트 변화를 그려봤다. 그림에서 보듯이 V자 형태를 나타내고 있다. 이 그림이 맞다면, 증가냐 감소냐의 이분법적인 틀을 벗어나 보면, 두 기간 사이에 소득 증가는 상위층을수록 하위층일수록 많이 누렸다. 중간층에게는 상대적으로 덜 돌아갔다. 


# The code 

분석한 코드는 모두 [github.com/anarinsk/MDIS](https://github.com/anarinsk/MDIS)에 공유되어 있다. 

# 정리

  * 30% 만 (경상)소득이 늘었다는 이야기가 가능하지만 가중치를 고려하면 전체 가구에 대해서는 50~60% 정도가 적절한 이야기다. 노동소득 가구는 거의 전 분위에서 소득이 올랐다. 
  * 퍼센트 변화를 보면 V 형태의 특징이 관찰된다.

---
title: "Comparing Korean Household Incomes"
author: anarinsk 
date: June 11, 2018
output: 
  html_document: 
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
#
source("./code_header.R")
readRDS("./data/tbl_gdpd.rds") -> tbl 
readRDS("./data/tbl_smr.rds") -> tbl_smr
#
```

# Disclaimer 

이 글은 언제나 '일시적'입니다. 문제가 생기면 항상 수정되거나 폐기됩니다. 대신 수정될 경우 변경 역사는 아래와 같이 간단히 남길 예정입니다. 각종 문의는 <anarinsk@gmail.com>로 메일 주시라. 

  1. 20180611 오타 수정 
  2. 20180612 샘플링 분포 그림 추가 

# 최근의 논란 

최근 최저임금 인상의 효과를 두고 몇가지 논란이 있었다. 일단 두 가지를 먼저 언급해야 겠다. 

  1. (사회) 실험이 아니기 때문에 최저 임금 인상의 효과를 인과관계라는 맥락에서 파악하는 것은 불가능하다. 
  2. 적용할 수 있는 계량경제학적 방법이 없는 것은 아니지만, 아직 관련한 본격적인 논의를 보지는 못했다.  
  
이 와중에 [조선비즈](http://biz.chosun.com/site/data/html_dir/2018/06/03/2018060300817.html)에 정부의 발표를 반박하는 기사가 실렸고, 이에 대해서 [블로고스피어](http://sovidence.tistory.com/950) 상의 비판이 있었다. 나는 이 논란에 개입하지 않을 것이다. 아울러 무슨 대단한 학술적인 의도나 목적을 지니고 있지 않다. 업계나 학계의 상식에 어긋나거나 황당한 내용이 있다면 언제든 지도편달 바란다. 달게 받고 수정하겠다. 다만 한가지 아쉬움만 지적하자. 90% 발언이 논란의 중심인 만큼 정부 혹은 국책 연구기관에서 보다 상세한 해설을 해줬으면 바라본다. 

## 글의 목적

  1. 데이터에 기반해 서로 무슨 생각을 하는지 명확히 확인하자. 
  2. 불필요한 사항으로 다투지 않는다. 

# 분석의 전제 

이 분석은 통계청에서 발표하는 가계동향조사에 바탕을 둔다. 이 자료의 여러 가지 한계는 잠시 접어두자. 한계가 있지만 그나마 빠르게 확인할 수 있는 자료가 이 녀석이니 쓰는 것이겠지. 이 분석은 다음과 같이 가정하겠다. 

  1. 가계동향조사를 믿겠다. 
  2. 조사의 가중치를 믿겠다. 

# 가중치를 어떻게 다룰 것인가? 

가중치는 결국 해당 가구가 모집단에서 어느 정도나 비중을 차지하고 있는지를 나타낸다. 2017년 판 "이용자 가이드"에 보면 다음과 같이 되어 있다. 

>가계동향조사의 가중치는 설계가중치와 무응답 가중치를 적용하고 사후 가중한 가중치를 가구별로 부여하며, 가중치는 추출률의 역수로서 각 가구가 대표하는 가구 수를 나타낸다.  

가중치에 관해서 교과서에 나오는 정도의 내용을 잘 반영했다는 이야기다. 대안적인 가중치를 구하고 싶어도 공개되지 않은 추가적인 자료가 필요하다. 그러니 일단 믿도록 하자. 가중치를 써 먹을 세가지 정도의 방법을 생각해보았다. 

  1. 100 분위 선정에서 가중치를 무시하고, 대신 100 분위 블록 내 소득 계산에 활용 
  2. 가중치 만큼 해당 샘플을 늘인 뒤, 확대된 샘플로 100분위 블록 계산 
  3. 가중치에 따른 확률에 따라서 100 개씩 뽑는 샘플링을 충분한 횟수로 반복 
  
첫번째 방법은 가중치를 무시하고 각 연도 샘플에서 100 분위를 구한다. 대신 해당 분위 내에서 평균 소득 혹은 중위 소득을 구할 때 해당 가중치를 활용해서 가중 평균, 가중 중간값을 구한다. 뭐 구질구질하지만 해볼만한 방법이다 싶다. 둘째 방법은 보다 직관적이다. 가중치는 샘플에 속한 각 가구가 대표하는 가구의 수다. 그 숫자대로 뻥튀기를 한 뒤 이 녀석으로 다시 100 분위를 내는 방법이다. 

1,2의 방법을 구현해서 [Shiny apps](http://209.97.160.244:3838/MDIS_Shiny_3/)으로 만들어 보았다. 좀 힘들었지만 어쨌든 했다. 결론은 아래 세번째 방법과 비슷하다. 

# 충분히 많은 수의 샘플링 

100 분위 소득이니 속편하게 샘플 수는 100 개로 하자. 그리고 이런 100개 단위 추출을 충분히 많이 반복한 후, 각 분위별로 소득의 평균을 구해서 비교한다. 과학적인 방법이 아닐지 모르지만, 제법 그럴 듯한 방법이 아닌가. 코드를 일부분 옮기면 다음과 같다. 

```{r echo=FALSE}
vars_basic <- c("V100", "V101", "V102", "V103")

pick_x <- function(year, x, df, what_V4 = c(1,2)){
  df %.>% 
    dplyr::filter(., V1 == year, V4 %in% what_V4) %.>% 
    sample_n(., size = x, replace = T, weight = V99)
}
sim_ndraw <- function(n_draw, what_V4, vars_sel = vars_basic, df=tbl){
#  
  list(year = c(rep(2017,n_draw), rep(2018,n_draw)),  round=c(seq(1:n_draw), seq(1:n_draw))) -> itr_sch
  
  itr_sch %.>% 
    pmap_df(., 
      function(year, round) {
        pick_x(year, 100, df, what_V4) %.>% 
        mutate(., rd = unlist(round)[1]) 
      } 
    ) %.>% 
    dplyr::select(., V1, V3, rd, one_of(vars_sel))
#
}
sim_summary <- function(var, funs, df){
  
  var_exp <- enquo(var)
  
  df %.>% 
    arrange(., V1, rd, -!!var_exp) %.>% 
    group_by(., V1, rd) %.>% 
    mutate(., rank_sample = seq(1:100)) %.>% 
    group_by(., V1, rank_sample) %.>% 
    summarise(., val = funs(!!var_exp)) %.>% 
    group_by(., rank_sample) %.>%  
    mutate(., V1 = factor(V1)) %.>% 
    spread(., key = V1, value = val) %.>% 
    rename(., 
      Y17 = `2017`,
      Y18 = `2018`
      )
}

#sim_ndraw(10000, c(1,2), c(vars_basic, "V106")) -> ttl1
#sim_ndraw(10000, c(1), c(vars_basic, "V106"))   -> ttl2
```

1만 번 샘플링한 위의 결과를 그림으로 나타내보자. 

```{r echo=FALSE}
readRDS("./data/ttl1.rds") -> ttl1 
readRDS("./data/ttl2.rds") -> ttl2 

ttl1 %.>% 
  sim_summary(V101, mean, .) %.>% 
  mutate(., 
    group = "all households" 
  )-> ttl1_1

ttl2 %.>% 
  sim_summary(V101, mean, .)  %.>% 
  mutate(., 
    group = "labor-income households" 
  )-> ttl2_1

ttl1_1 %.>% bind_rows(., ttl2_1) -> tbl_smr 
tbl_smr %.>% ggplot(.) + 
  aes(x = rank_sample, y = Y18-Y17) + 
  geom_col(color = "black") + 
  facet_grid(.~group, scales = "free_y") + 
  ggtitle("Sampling Income Mean") + 
  xlab("rank(descending order)") + 
  ylab("income difference(2018-2017)") +
  theme_economist()
  
tbl_smr %.>% ggplot(.) + 
  aes(x = rank_sample, y = (Y18-Y17)*100/Y17) + 
  geom_col(color = "black") + 
  facet_wrap(~group, ncol=2) + 
  ggtitle("Sampling Income Change") + 
  xlab("rank(descending order)") + 
  ylab("Change(%)") +
  theme_economist() 
```


## 경상 소득의 경우 

여기서 전체가구(all households)란 노동소득 가구(labor-income households)와 노동외소득 가구(nonlabor-income households)를 모두 포괄한다. 이렇게 보면 상위 54 분위까지 그리고 하위에 속한 98, 99, 100 분위에서 소득 증가가 관찰된다. 노동소득 가구만 보면 전체 분위에서 증가를 관찰할 수 있다. 

## 퍼센트 변화 

소득 규모에 따른 효과를 보기 위해서 각 구간별로 퍼센트 변화를 살펴 봤다. 그림에서 보듯이 V자 형태를 나타내고 있다. 이 그림이 맞다면, 증가냐 감소냐의 이분법적인 틀을 벗어나 보면, 두 기간 사이에 소득 증가는 상위층을수록 하위층일수록 많이 누렸다. 중간층에게는 상대적으로 덜 돌아갔다. 

## 샘플링 분포에 관해서 

이렇게 뽑힌 100 분위 소득의 경우 각 분위별로 1 만개의 관찰 수를 지니고 있다. 이 관찰 수들의 분포는 어떤 모양일까? 호기심에 한번 그려보았다. 

```{r echo=FALSE, message=FALSE}
readRDS("./data/gg_dst1_1.rds") -> gg_dst1_1
readRDS("./data/gg_dst1_2.rds") -> gg_dst1_2
readRDS("./data/gg_dst2_1.rds") -> gg_dst2_1
readRDS("./data/gg_dst2_2.rds") -> gg_dst2_2
#
gg_dst1_1 + gg_dst1_2 + plot_layout(ncol = 1, heights = c(2, 2))
gg_dst2_1 + gg_dst2_2 + plot_layout(ncol = 1, heights = c(2, 2))
```

그림에서 보듯이 상위 10%에 대해서는 분포가 별다른 의미를 지니지 않는다. "가계동향조사"로 상위층 특히 극상위층의 소득을 추정하는 작업에 문제가 있다는 그간의 코멘트에 대해서 끄덕이게 되는 대목이다. 아울러, 대략 상위 20% 이상부터는 분포의 형태가 어그러지고 있어서 비교에 의미가 없지 않을까, 하는 생각이 들기도 한다. 

# The code 

[github.com/anarinsk/MDIS](https://github.com/anarinsk/MDIS)

이 문서를 포함해 모든 소스는 리퍼지토리에 있다. 마음껏 가져다 쓰시라! (그런데 MDIS 사용 규약에는 어긋나더라...)

# 정리

  * 샘플의 30% 정도만 (경상) 소득이 늘었다는 이야기가 일부 자료에서는 유사한 형태로 재현 가능하다. 하지만 가중치를 고려하면 전체 가구에 대해서는 50~60% 정도의 소득 증가가 적절한 이야기가 아닐까 싶다. 노동소득 가구는 거의 전 분위에서 경상 소득이 증가했다. 최근 경기를 고려하면 상식적으로 타당하다. 
  * 퍼센트 변화를 보면 V 형태의 특징이 관찰된다. 관련한 해석은 각자 알아서. 